<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤ - ‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ WS</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js"></script>
</head>
<body>
    <header>
        <h1>‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ "WS"</h1>
    </header>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</title>
    <button onclick="toggleMenu()">‡πÄ‡∏°‡∏ô‡∏π</button>
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #d63384; padding: 8px; text-align: center; }
        th { background-color: #d63384; color: white; }
        .btn { padding: 5px 10px; margin: 5px; cursor: pointer; border: none; }
        .btn.add { background-color: #008CBA; color: white; }
        .btn.delete { background-color: #f44336; color: white; }
        .btn.edit { background-color: #ff9800; color: white; }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBCWzkum4x8wj_lStJXYbLioJIgGCN8kxE",
            authDomain: "domitory-1a0c3-9c643.firebaseapp.com",
            projectId: "domitory-1a0c3-9c643",
            storageBucket: "domitory-1a0c3-9c643.appspot.com",
            messagingSenderId: "1007665182785",
            appId: "1:1007665182785:web:a72f91da9f23ac6f206ec0",
            measurementId: "G-W36W2WEFCB"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let editId = null; // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

        async function submitLeaseContract() {
            const lesseeName = document.getElementById("lesseeName").value;
            const guarantorName = document.getElementById("guarantorName").value;
            const leaseTerm = document.getElementById("leaseTerm").value;
            const rentRate = document.getElementById("rentRate").value;
            const deposit = document.getElementById("deposit").value;
            const contractFile = document.getElementById("contractFile").value;

            if (!lesseeName || !guarantorName || !leaseTerm || !rentRate || !deposit || !contractFile) {
                alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            try {
                if (editId) {
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                    await updateDoc(doc(db, "lease_contract_system", editId), {
                        lesseeName,
                        guarantorName,
                        leaseTerm: parseInt(leaseTerm),
                        rentRate: parseFloat(rentRate),
                        deposit: parseFloat(deposit),
                        contractFile,
                        timestamp: serverTimestamp()
                    });
                    alert("‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                    editId = null; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤ editId ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à
                } else {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                    await addDoc(collection(db, "lease_contract_system"), {
                        lesseeName,
                        guarantorName,
                        leaseTerm: parseInt(leaseTerm),
                        rentRate: parseFloat(rentRate),
                        deposit: parseFloat(deposit),
                        contractFile,
                        timestamp: serverTimestamp()
                    });
                    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                }

                document.getElementById("leaseContractForm").reset(); // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
                loadLeaseContracts(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            } catch (error) {
                console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
                alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
            }
        }

        async function loadLeaseContracts() {
            console.log("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
            const leaseTable = document.querySelector("#leaseTable tbody");
            leaseTable.innerHTML = "<tr><td colspan='7'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>";

            const querySnapshot = await getDocs(collection(db, "lease_contract_system"));
            leaseTable.innerHTML = "";

            if (querySnapshot.empty) {
                leaseTable.innerHTML = "<tr><td colspan='7'>üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
                return;
            }

            querySnapshot.forEach((doc) => {
                const lease = doc.data();
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td>${lease.lesseeName}</td>
                    <td>${lease.guarantorName}</td>
                    <td>${lease.leaseTerm} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
                    <td>${lease.rentRate} ‡∏ö‡∏≤‡∏ó</td>
                    <td>${lease.deposit} ‡∏ö‡∏≤‡∏ó</td>
                    <td>
                        <a href="${lease.contractFile}" target="_blank">üìÑ ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</a>
                    </td>
                    <td>
                        <button class="btn edit" onclick="editLease('${doc.id}', '${lease.lesseeName}', '${lease.guarantorName}', '${lease.leaseTerm}', '${lease.rentRate}', '${lease.deposit}', '${lease.contractFile}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn delete" onclick="deleteLease('${doc.id}')">üóë ‡∏•‡∏ö</button>
                    </td>
                `;
                leaseTable.appendChild(row);
            });

            console.log("‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!");
        }

        function editLease(id, lesseeName, guarantorName, leaseTerm, rentRate, deposit, contractFile) {
            document.getElementById("lesseeName").value = lesseeName;
            document.getElementById("guarantorName").value = guarantorName;
            document.getElementById("leaseTerm").value = leaseTerm;
            document.getElementById("rentRate").value = rentRate;
            document.getElementById("deposit").value = deposit;
            document.getElementById("contractFile").value = contractFile;
            editId = id;
        }

        async function deleteLease(id) {
            if (confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?")) {
                await deleteDoc(doc(db, "lease_contract_system", id));
                alert("üóë ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                loadLeaseContracts();
            }
        }

        window.onload = loadLeaseContracts;
        window.submitLeaseContract = submitLeaseContract;
        window.editLease = editLease;
        window.deleteLease = deleteLease;
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π
        window.toggleMenu = function() {
            const menu = document.getElementById("menu");
            if (menu.style.display === "block") {
                menu.style.display = "none";
            } else {
                menu.style.display = "block";
            }
        };
    </script>
    <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° -->
    <div id="menu" class="menu">
        <ul>
            <li><a href="bill.html">‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</a></li>
            <li><a href="pending-payments.html">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a></li>
            <li><a href="paid-payments.html">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</a></li>
            <li><a href="move-out-pending.html">‡∏£‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</a></li>
            <li><a href="moved-out.html">‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</a></li>
            <li><a href="manage-residents.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</a></li>
            <li><a href="manage-room-owners.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</a></li>
            <li><a href="manage-room-types.html">‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</a></li>
            <li><a href="manage-rooms.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</a></li>
            <li><a href="lease_contract_system.html">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</a></li>
            <li><a href="manage-rates.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏ó‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="logout.html">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></li>
        </ul>
    </div>
</head>
<body>
    
    <h2>üìú ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</h2>
    <form id="leaseContractForm">
        <label>üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤:</label><input type="text" id="lesseeName"><br><br>
        <label>üë• ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ñ‡πâ‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô:</label><input type="text" id="guarantorName"><br><br>
        <label>üìÖ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πà‡∏≤:</label><input type="number" id="leaseTerm"><br><br>
        <label>üí∞ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤:</label><input type="number" id="rentRate"><br><br>
        <label>üíµ ‡∏°‡∏±‡∏î‡∏à‡∏≥:</label><input type="number" id="deposit"><br><br>
        <label>üìé ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</label>
        <input type="text" id="contractFile"><br><br>
        <button type="button" class="btn add" onclick="submitLeaseContract()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </form>

    <table id="leaseTable">
        <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ñ‡πâ‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</th><th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πà‡∏≤</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</th><th>‡∏°‡∏±‡∏î‡∏à‡∏≥</th><th>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody></tbody>
    </table>
</body>
</html>
