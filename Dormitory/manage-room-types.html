<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จัดการห้องพัก - Firestore</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #d63384; padding: 8px; text-align: center; }
        th { background-color: #d63384; color: white; }
        .btn { padding: 5px 10px; margin: 5px; cursor: pointer; border: none; }
        .btn.delete { background-color: #f44336; color: white; }
        .btn.edit { background-color: #ffa500; color: white; }
        .btn.add { background-color: #008CBA; color: white; }

        /* ปรับแต่งสไตล์สำหรับเมนู */
        .menu {
            display: none; /* ซ่อนเมนูเริ่มต้น */
            position: absolute;
            top: 50px;
            left: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            width: 200px;
        }
        .menu ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .menu li {
            margin: 10px 0;
        }
        .menu li a {
            text-decoration: none;
            color: #333;
            padding: 8px;
            display: block;
            transition: background-color 0.3s;
        }
        .menu li a:hover {
            background-color: #f1f1f1;
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } 
        from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBCWzkum4x8wj_lStJXYbLioJIgGCN8kxE",
            authDomain: "domitory-1a0c3-9c643.firebaseapp.com",
            projectId: "domitory-1a0c3-9c643",
            storageBucket: "domitory-1a0c3-9c643.firebasestorage.app",
            messagingSenderId: "1007665182785",
            appId: "1:1007665182785:web:a72f91da9f23ac6f206ec0",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function loadRooms() {
            const roomTable = document.querySelector("#roomTable tbody");
            const q = query(collection(db, "rooms"), orderBy("id", "asc"));

            onSnapshot(q, (snapshot) => {
                roomTable.innerHTML = "";
                if (snapshot.empty) {
                    roomTable.innerHTML = `<tr><td colspan="5">ไม่มีข้อมูลห้องพัก</td></tr>`;
                    return;
                }

                snapshot.forEach((doc) => {
                    const room = doc.data();
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${room.id}</td>
                        <td>${room.ประเภทห้อง || "ไม่ระบุ"}</td>
                        <td>${room.ราคาค่าเช่าต่อเดือน || "ไม่ระบุ"}</td>
                        <td>${room.ค่ามัดจำ || "ไม่ระบุ"}</td>
                        <td>
                            <button class="btn edit" onclick="fillForm('${doc.id}', '${room.id}', '${room.ประเภทห้อง}', '${room.ราคาค่าเช่าต่อเดือน}', '${room.ค่ามัดจำ}')">แก้ไข</button>
                            <button class="btn delete" onclick="deleteRoom('${doc.id}')">ลบ</button>
                        </td>
                    `;
                    roomTable.appendChild(row);
                });
            });
        }

        window.fillForm = function(docId, id, type, rent, deposit) {
            document.getElementById("roomId").value = docId;
            document.getElementById("roomNumber").value = id;
            document.getElementById("roomType").value = type;
            document.getElementById("rentPrice").value = rent.replace(" บาท", "");
            document.getElementById("deposit").value = deposit.replace(" บาท", "");
        }

        window.submitForm = async function() {
            const docId = document.getElementById("roomId").value;
            const id = document.getElementById("roomNumber").value;
            const type = document.getElementById("roomType").value;
            const rent = document.getElementById("rentPrice").value;
            const deposit = document.getElementById("deposit").value;

            if (!id || !type || !rent || !deposit) {
                alert("กรุณากรอกข้อมูลให้ครบถ้วน");
                return;
            }

            try {
                if (docId) {
                    // แก้ไขข้อมูลห้อง
                    await updateDoc(doc(db, "rooms", docId), {
                        id: id,
                        ประเภทห้อง: type,
                        ราคาค่าเช่าต่อเดือน: rent + " บาท",
                        ค่ามัดจำ: deposit + " บาท"
                    });
                    alert("อัปเดตข้อมูลสำเร็จ!");
                } else {
                    // เพิ่มห้องใหม่
                    await addDoc(collection(db, "rooms"), {
                        id: id,
                        ประเภทห้อง: type,
                        ราคาค่าเช่าต่อเดือน: rent + " บาท",
                        ค่ามัดจำ: deposit + " บาท"
                    });
                    alert("เพิ่มห้องสำเร็จ!");
                }
                document.getElementById("roomForm").reset();
            } catch (error) {
                alert("เกิดข้อผิดพลาด: " + error);
            }
        }

        window.deleteRoom = async function(docId) {
            if (confirm("คุณต้องการลบห้องนี้หรือไม่?")) {
                try {
                    await deleteDoc(doc(db, "rooms", docId));
                    alert("ลบห้องสำเร็จ!");
                } catch (error) {
                    alert("เกิดข้อผิดพลาด: " + error);
                }
            }
        }

        // ฟังก์ชันสำหรับเปิด/ปิดเมนู
        window.toggleMenu = function() {
            const menu = document.getElementById("menu");
            if (menu.style.display === "block") {
                menu.style.display = "none";
            } else {
                menu.style.display = "block";
            }
        }

        loadRooms();
    </script>
</head>
<body>
    <h2>จัดการห้องพัก</h2>

    <!-- ฟอร์มกรอกข้อมูล -->
    <form id="roomForm">
        <input type="hidden" id="roomId">
        <table>
            <tr>
                <th>เลขห้อง</th>
                <th>ประเภทห้อง</th>
                <th>ราคาค่าเช่า</th>
                <th>ค่ามัดจำ</th>
                <th>จัดการ</th>
            </tr>
            <tr>
                <td><input type="text" id="roomNumber" required></td>
                <td><input type="text" id="roomType" required></td>
                <td><input type="text" id="rentPrice" required></td>
                <td><input type="text" id="deposit" required></td>
                <td><button type="button" class="btn add" onclick="submitForm()">เพิ่ม/แก้ไข</button></td>
            </tr>
        </table>
    </form>

    <h3>รายการห้องพัก</h3>
    <table id="roomTable">
        <thead>
            <tr>
                <th>Id</th>
                <th>ประเภทห้อง</th>
                <th>ราคาค่าเช่า</th>
                <th>ค่ามัดจำ</th>
                <th>จัดการ</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ปุ่มสำหรับเปิดเมนู -->
    <button onclick="toggleMenu()">เมนู</button>

    <!-- เมนูที่แสดงเมื่อคลิกปุ่ม -->
    <div id="menu" class="menu">
        <ul>
            <li><a href="bill.html">ออกบิล</a></li>
            <li><a href="pending-payments.html">รายการรอชำระเงิน</a></li>
            <li><a href="paid-payments.html">รายการชำระเงินแล้ว</a></li>
            <li><a href="move-out-pending.html">รอย้ายออก</a></li>
            <li><a href="moved-out.html">ย้ายออกแล้ว</a></li>
            <li><a href="manage-residents.html">จัดการข้อมูลผู้เข้าพัก</a></li>
            <li><a href="manage-room-owners.html">จัดการข้อมูลเจ้าของห้องพัก</a></li>
            <li><a href="manage-room-types.html">จัดข้อมูลประเภทห้องพัก</a></li>
            <li><a href="manage-rooms.html">จัดการห้องพัก</a></li>
            <li><a href="manage-rates.html">จัดการเรทค่าน้ำค่าไฟ</a></li>
            <li><a href="logout.html">ออกจากระบบ</a></li>
        </ul>
    </div>
</body>
</html>
