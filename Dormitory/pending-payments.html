<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô - ‡∏´‡∏≠‡∏û‡∏±‡∏Å WS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ "WS"</h1>
    </header>
    <button onclick="toggleMenu()">‡πÄ‡∏°‡∏ô‡∏π</button>
    <div id="menu" class="menu" style="display: none;">
        <ul>
            <li><a href="bill.html">‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</a></li>
            <li><a href="pending-payments.html">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a></li>
            <li><a href="paid-payments.html">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</a></li>
            <li><a href="move-out-pending.html">‡∏£‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</a></li>
            <li><a href="moved-out.html">‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</a></li>
            <li><a href="manage-residents.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</a></li>
            <li><a href="manage-room-owners.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</a></li>
            <li><a href="manage-room-types.html">‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</a></li>
            <li><a href="manage-rooms.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</a></li>
            <li><a href="lease_contract_system.html">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</a></li>
            <li><a href="manage-rates.html">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏ó‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="logout.html">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></li>
        </ul>
    </div>
    <main>
        <h2>üìú ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
        
        <table id="paymentTable">
            <thead>
                <tr>
                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏¥‡∏•</th>
                    <th>‡∏´‡πâ‡∏≠‡∏á</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏Å</th>
                    <th>‡∏£‡∏≠‡∏ö‡∏ö‡∏¥‡∏•</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
        <form id="paymentForm">
            <input type="hidden" id="recordId">
            <label>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏¥‡∏•: <input type="text" id="billId" required></label>
            <label>‡∏´‡πâ‡∏≠‡∏á: <input type="text" id="room" required></label>
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏Å: <input type="text" id="residentName" required></label>
            <label>‡∏£‡∏≠‡∏ö‡∏ö‡∏¥‡∏•: <input type="text" id="billingCycle" required></label>
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: 
                <select id="status" required>
                    <option value="‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</option>
                    <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
                </select>
            </label>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: <input type="number" id="amount" required></label>
            <button type="submit" id="addButton">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            <button type="button" id="updateButton" style="display: none;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </form>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBCWzkum4x8wj_lStJXYbLioJIgGCN8kxE",
            authDomain: "domitory-1a0c3-9c643.firebaseapp.com",
            projectId: "domitory-1a0c3-9c643",
            storageBucket: "domitory-1a0c3-9c643.appspot.com",
            messagingSenderId: "1007665182785",
            appId: "1:1007665182785:web:a72f91da9f23ac6f206ec0",
            measurementId: "G-W36W2WEFCB"
        };
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const paymentsCollection = collection(db, "pendingPayments");
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore
        async function fetchPayments() {
            const tableBody = document.querySelector("#paymentTable tbody");
            tableBody.innerHTML = "";
            const snapshot = await getDocs(paymentsCollection);
        
            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${data.billId}</td>
                    <td>${data.room}</td>
                    <td>${data.residentName}</td>
                    <td>${data.billingCycle}</td>
                    <td>${data.status}</td>
                    <td>${data.amount} ‡∏ö‡∏≤‡∏ó</td>
                    <td>
                        <button class="edit-btn" onclick="editRecord('${docSnap.id}', '${data.billId}', '${data.room}', '${data.residentName}', '${data.billingCycle}', '${data.status}', '${data.amount}')">üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="delete-btn" onclick="deleteRecord('${docSnap.id}')">üóë ‡∏•‡∏ö</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        async function addRecord(event) {
            event.preventDefault();
            const billId = document.getElementById("billId").value;
            const room = document.getElementById("room").value;
            const residentName = document.getElementById("residentName").value;
            const billingCycle = document.getElementById("billingCycle").value;
            const status = document.getElementById("status").value;
            const amount = document.getElementById("amount").value;
        
            await addDoc(paymentsCollection, { billId, room, residentName, billingCycle, status, amount });
            alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            resetForm();
            await fetchPayments();  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        window.editRecord = function (id, billId, room, residentName, billingCycle, status, amount) {
            document.getElementById("recordId").value = id;
            document.getElementById("billId").value = billId;
            document.getElementById("room").value = room;
            document.getElementById("residentName").value = residentName;
            document.getElementById("billingCycle").value = billingCycle;
            document.getElementById("status").value = status;
            document.getElementById("amount").value = amount;
            
            document.getElementById("updateButton").style.display = "inline-block";
            document.getElementById("addButton").style.display = "none";
        };
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function updateRecord(event) {
            event.preventDefault();
            const recordId = document.getElementById("recordId").value;
        
            if (recordId) {
                await updateDoc(doc(db, "pendingPayments", recordId), {
                    billId: document.getElementById("billId").value,
                    room: document.getElementById("room").value,
                    residentName: document.getElementById("residentName").value,
                    billingCycle: document.getElementById("billingCycle").value,
                    status: document.getElementById("status").value,
                    amount: document.getElementById("amount").value
                });
        
                alert("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                resetForm();
                await fetchPayments();  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        window.deleteRecord = async function (id) {
            if (confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                await deleteDoc(doc(db, "pendingPayments", id));
                alert("üóë ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                await fetchPayments();
            }
        };
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
        function resetForm() {
            document.getElementById("paymentForm").reset();
            document.getElementById("recordId").value = "";
            document.getElementById("updateButton").style.display = "none";
            document.getElementById("addButton").style.display = "inline-block";
        }
        
        // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        document.getElementById("updateButton").addEventListener("click", updateRecord);
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener("DOMContentLoaded", fetchPayments);
        
        window.toggleMenu = function() {
            const menu = document.getElementById("menu");
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        };
    </script>
</body>
</html>
